definition user {}


definition role {
	relation entity: domain
	relation member: user
	relation built_in_role: domain

	permission delete = entity->manage_role_permission - built_in_role->manage_role_permission
	permission update = entity->manage_role_permission - built_in_role->manage_role_permission
	permission read = entity->manage_role_permission - built_in_role->manage_role_permission

	permission add_user = entity->add_role_users_permission
	permission remove_user = entity->remove_role_users_permission
	permission view_user = entity->view_role_users_permission
}

definition domain {
	//Replace platform with organization in future
	relation organization: platform
	relation team: team
	
	relation update: role#member | team#member
	relation enable: role#member | team#member
	relation disable: role#member | team#member
	relation read: role#member | team#member
	relation delete: role#member | team#member

	relation manage_role: role#member | team#member
	relation add_role_users: role#member | team#member
	relation remove_role_users: role#member | team#member
	relation view_role_users: role#member | team#member

	relation llm_create: role#member | team#member
	relation llm_update: role#member | team#member
	relation llm_read: role#member | team#member
	relation llm_delete: role#member | team#member
	relation llm_chat_completions: role#member | team#member
	relation llm_completions: role#member | team#member
	relation llm_embeddings: role#member | team#member
	relation llm_transcription: role#member | team#member
	relation llm_translation: role#member | team#member
	relation llm_utility: role#member | team#member
	relation llm_pooling: role#member | team#member
	relation llm_classification: role#member | team#member
	relation llm_scoring: role#member | team#member
	relation llm_rerank: role#member | team#member

	relation llm_manage_role: role#member | team#member
	relation llm_add_role_users: role#member | team#member
	relation llm_remove_role_users: role#member | team#member
	relation llm_view_role_users: role#member | team#member

	relation audit_log_read: role#member | team#member
	relation audit_log_export: role#member | team#member

	relation audit_log_manage_role: role#member | team#member
	relation audit_log_add_role_users: role#member | team#member
	relation audit_log_remove_role_users: role#member | team#member
	relation audit_log_view_role_users: role#member | team#member

	permission update_permission = update + team->domain_update + organization->admin
	permission read_permission = read + team->domain_read + organization->admin
	permission enable_permission = enable + team->domain_update + organization->admin
	permission disable_permission = disable + team->domain_update + organization->admin
	permission delete_permission = delete + team->domain_delete + organization->admin

	permission manage_role_permission = manage_role + team->domain_manage_role + organization->admin
	permission add_role_users_permission = add_role_users + team->domain_add_role_users + organization->admin
	permission remove_role_users_permission = remove_role_users + team->domain_remove_role_users + organization->admin
	permission view_role_users_permission = view_role_users + team->domain_view_role_users + organization->admin

	permission membership = read + update + enable + disable + delete +
	manage_role + add_role_users + remove_role_users + view_role_users +
	manage_role + add_role_users + remove_role_users + view_role_users +
	llm_create + llm_update + llm_read + llm_delete + llm_chat_completions + llm_completions + llm_embeddings +
	llm_transcription + llm_translation + llm_utility + llm_pooling + llm_classification + llm_scoring + llm_rerank +
	llm_manage_role + llm_add_role_users + llm_remove_role_users + llm_view_role_users +
	audit_log_read + audit_log_export +
	audit_log_manage_role + audit_log_add_role_users + audit_log_remove_role_users + audit_log_view_role_users + organization->admin

	permission admin = (read & update & enable & disable & delete & manage_role & add_role_users & remove_role_users & view_role_users) + organization->admin

	permission llm_create_permission = llm_create + team->llm_create + organization->admin
	permission llm_update_permission = llm_update + team->llm_update + organization->admin
	permission llm_read_permission = llm_read + team->llm_read + organization->admin
	permission llm_delete_permission = llm_delete + team->llm_delete + organization->admin
	permission llm_chat_completions_permission = llm_chat_completions + team->llm_chat_completions + organization->admin
	permission llm_completions_permission = llm_completions + team->llm_completions + organization->admin
	permission llm_embeddings_permission = llm_embeddings + team->llm_embeddings + organization->admin
	permission llm_transcription_permission = llm_transcription + team->llm_transcription + organization->admin
	permission llm_translation_permission = llm_translation + team->llm_translation + organization->admin
	permission llm_utility_permission = llm_utility + team->llm_utility + organization->admin
	permission llm_pooling_permission = llm_pooling + team->llm_pooling + organization->admin
	permission llm_classification_permission = llm_classification + team->llm_classification + organization->admin
	permission llm_scoring_permission = llm_scoring + team->llm_scoring + organization->admin
	permission llm_rerank_permission = llm_rerank + team->llm_rerank + organization->admin

	permission llm_manage_role_permission = llm_manage_role + team->llm_manage_role + organization->admin
	permission llm_add_role_users_permission = llm_add_role_users + team->llm_add_role_users + organization->admin
	permission llm_remove_role_users_permission = llm_remove_role_users + team->llm_remove_role_users + organization->admin
	permission llm_view_role_users_permission = llm_view_role_users + team->llm_view_role_users + organization->admin

	permission audit_log_read_permission = audit_log_read + team->audit_log_read + organization->admin
	permission audit_log_export_permission = audit_log_export + team->audit_log_export + organization->admin

	permission audit_log_manage_role_permission = audit_log_manage_role + team->audit_log_manage_role + organization->admin
	permission audit_log_add_role_users_permission = audit_log_add_role_users + team->audit_log_add_role_users + organization->admin
	permission audit_log_remove_role_users_permission = audit_log_remove_role_users + team->audit_log_remove_role_users + organization->admin
	permission audit_log_view_role_users_permission = audit_log_view_role_users + team->audit_log_view_role_users + organization->admin
}

// Add this relation and permission in future while adding organization
definition team {
	relation organization: organization
	relation parent_team: team

	relation delete: role#member
	relation enable: role#member | team#member
	relation disable: role#member | team#member
	relation update: role#member
	relation read: role#member

	relation set_parent: role#member
	relation set_child: role#member

	relation member: role#member

	relation manage_role: role#member
	relation add_role_users: role#member
	relation remove_role_users: role#member
	relation view_role_users: role#member

	relation subteam_delete: role#member
	relation subteam_update: role#member
	relation subteam_read: role#member

	relation subteam_member: role#member

	relation subteam_set_child: role#member
	relation subteam_set_parent: role#member

	relation subteam_manage_role: role#member
	relation subteam_add_role_users: role#member
	relation subteam_remove_role_users: role#member
	relation subteam_view_role_users: role#member

    // Domain related permission

	relation domain_update: role#member | team#member
	relation domain_read: role#member | team#member
	relation domain_membership: role#member | team#member
	relation domain_delete: role#member | team#member

	relation domain_manage_role: role#member | team#member
	relation domain_add_role_users: role#member | team#member
	relation domain_remove_role_users: role#member | team#member
	relation domain_view_role_users: role#member | team#member

	relation llm_create: role#member | team#member
	relation llm_update: role#member | team#member
	relation llm_read: role#member | team#member
	relation llm_delete: role#member | team#member
	relation llm_chat_completions: role#member | team#member
	relation llm_completions: role#member | team#member
	relation llm_embeddings: role#member | team#member
	relation llm_transcription: role#member | team#member
	relation llm_translation: role#member | team#member
	relation llm_utility: role#member | team#member
	relation llm_pooling: role#member | team#member
	relation llm_classification: role#member | team#member
	relation llm_scoring: role#member | team#member
	relation llm_rerank: role#member | team#member

	relation llm_manage_role: role#member | team#member
	relation llm_add_role_users: role#member | team#member
	relation llm_remove_role_users: role#member | team#member
	relation llm_view_role_users: role#member | team#member

	relation audit_log_read: role#member | team#member
	relation audit_log_export: role#member | team#member

	relation audit_log_manage_role: role#member | team#member
	relation audit_log_add_role_users: role#member | team#member
	relation audit_log_remove_role_users: role#member | team#member
	relation audit_log_view_role_users: role#member | team#member

	permission delete_permission = delete + organization->team_delete + parent_team->subteam_delete + organization->admin
	permission update_permission = update + organization->team_update + parent_team->subteam_update + organization->admin
	permission read_permission = read + organization->team_read + parent_team->subteam_read + organization->admin

	permission set_parent_permission = set_parent + organization->team_set_parent + parent_team->subteam_set_parent + organization->admin
	permission set_child_permisssion = set_child + organization->team_set_child + parent_team->subteam_set_child + organization->admin

    permission membership = member + organization->team_member + parent_team->subteam_member + organization->admin

	permission manage_role_permission = manage_role + organization->team_manage_role + parent_team->subteam_manage_role + organization->admin
	permission add_role_users_permission = add_role_users + organization->team_add_role_users + parent_team->subteam_add_role_users + organization->admin
	permission remove_role_users_permission = remove_role_users + organization->team_remove_role_users + parent_team->subteam_remove_role_users + organization->admin
	permission view_role_users_permission = view_role_users + organization->team_view_role_users + parent_team->subteam_view_role_users + organization->admin
}

definition organization {
	relation platform: platform
	relation administrator: user

	relation delete: role#member
	relation update: role#member
	relation read: role#member

	relation member: role#member

	relation manage_role: role#member
	relation add_role_users: role#member
	relation remove_role_users: role#member
	relation view_role_users: role#member

	relation team_create: role#member

	relation team_delete: role#member
	relation team_update: role#member
	relation team_read: role#member

	relation team_member: role#member  // Will be member of all the teams in the organization

	relation team_set_child: role#member
	relation team_set_parent: role#member

	relation team_manage_role: role#member
	relation team_add_role_users: role#member
	relation team_remove_role_users: role#member
	relation team_view_role_users: role#member

	permission admin = administrator + platform->administrator
	permission delete_permission = admin + delete->member
	permission update_permission = admin + update->member
	permission read_permission = admin + read->member

	permission membership = admin + member->member

	permission team_create_permission = admin + team_create->member

	permission manage_role_permission = admin + manage_role
	permission add_role_users_permisson = admin + add_role_users
	permission remove_role_users_permission = admin + remove_role_users
	permission view_role_users_permission = admin + view_role_users
}

definition platform {
  relation administrator: user
  relation member: user

  permission admin = administrator
  permission membership = administrator + member
}
